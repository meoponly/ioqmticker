<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IOQM Study Tracker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
        }
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        @keyframes slideInLeft {
            from { transform: translateX(-100px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        @keyframes slideInRight {
            from { transform: translateX(100px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        @keyframes glow {
            0%, 100% { box-shadow: 0 0 20px rgba(59, 130, 246, 0.3); }
            50% { box-shadow: 0 0 40px rgba(59, 130, 246, 0.6); }
        }
        
        .animate-fadeIn {
            animation: fadeIn 0.3s ease-out;
        }
        .animate-slideUp {
            animation: slideUp 0.3s ease-out;
        }
        .animate-float {
            animation: float 3s ease-in-out infinite;
        }
        .animate-pulse-slow {
            animation: pulse 2s ease-in-out infinite;
        }
        .animate-slideInLeft {
            animation: slideInLeft 0.6s ease-out;
        }
        .animate-slideInRight {
            animation: slideInRight 0.6s ease-out;
        }
        .animate-glow {
            animation: glow 2s ease-in-out infinite;
        }
        
        /* Gradient background */
        .gradient-bg {
            background: linear-gradient(135deg, #1e3a8a 0%, #3730a3 50%, #1e293b 100%);
            position: relative;
            overflow: hidden;
        }
        
        /* Animated background shapes */
        .bg-shape {
            position: absolute;
            border-radius: 50%;
            opacity: 0.1;
            animation: float 6s ease-in-out infinite;
        }
        
        .bg-shape-1 {
            width: 300px;
            height: 300px;
            background: linear-gradient(45deg, #3b82f6, #8b5cf6);
            top: -100px;
            left: -100px;
            animation-delay: 0s;
        }
        
        .bg-shape-2 {
            width: 200px;
            height: 200px;
            background: linear-gradient(45deg, #ec4899, #f43f5e);
            bottom: -50px;
            right: -50px;
            animation-delay: 1s;
        }
        
        .bg-shape-3 {
            width: 150px;
            height: 150px;
            background: linear-gradient(45deg, #10b981, #14b8a6);
            top: 50%;
            right: 10%;
            animation-delay: 2s;
        }
        
        /* Glass morphism effect */
        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        /* Input focus effect */
        .fancy-input:focus {
            transform: translateY(-2px);
            box-shadow: 0 10px 40px rgba(255, 255, 255, 0.1) !important;
            border-color: #555555 !important;
        }
        
        /* Button hover effect */
        .fancy-button {
            position: relative;
            overflow: hidden;
            transition: all 0.3s;
        }
        
        .fancy-button::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }
        
        .fancy-button:hover::before {
            width: 300px;
            height: 300px;
        }
        
        .fancy-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 50px rgba(0, 0, 0, 0.4);
        }
        
        /* Dark mode styles */
        body.dark-mode {
            background-color: #1a1a1a;
            color: #e5e5e5;
        }
        body.dark-mode .bg-white {
            background-color: #2d2d2d !important;
        }
        body.dark-mode .text-gray-900 {
            color: #e5e5e5 !important;
        }
        body.dark-mode .text-gray-600 {
            color: #a0a0a0 !important;
        }
        body.dark-mode .text-gray-700 {
            color: #b0b0b0 !important;
        }
        body.dark-mode .border-gray-200 {
            border-color: #404040 !important;
        }
        body.dark-mode .bg-gray-50 {
            background-color: #252525 !important;
        }
        body.dark-mode .bg-gray-100 {
            background-color: #333333 !important;
        }
        body.dark-mode .bg-gray-200 {
            background-color: #404040 !important;
        }
        body.dark-mode .hover\:bg-gray-50:hover {
            background-color: #333333 !important;
        }
        body.dark-mode .hover\:bg-gray-100:hover {
            background-color: #3d3d3d !important;
        }
        body.dark-mode #login-screen {
            background: linear-gradient(135deg, #0f172a 0%, #1e1b4b 50%, #0f172a 100%) !important;
        }
        body.dark-mode .glass-card {
            background: rgba(30, 30, 30, 0.95) !important;
            border: 1px solid rgba(255, 255, 255, 0.1) !important;
        }
        body.dark-mode input {
            background-color: #1f1f1f !important;
            color: #e5e5e5 !important;
            border-color: #404040 !important;
        }
        body.dark-mode input::placeholder {
            color: #888888 !important;
        }
        body.dark-mode .fancy-input:focus {
            box-shadow: 0 10px 40px rgba(59, 130, 246, 0.5) !important;
        }
        body.dark-mode .text-gray-700 {
            color: #d1d5db !important;
        }
        body.dark-mode .text-gray-500 {
            color: #9ca3af !important;
        }
        body.dark-mode .text-gray-600 {
            color: #a0a0a0 !important;
        }
        body.dark-mode .bg-blue-50 {
            background-color: rgba(59, 130, 246, 0.1) !important;
        }
        body.dark-mode .bg-purple-50 {
            background-color: rgba(139, 92, 246, 0.1) !important;
        }
        body.dark-mode .border-gray-200 {
            border-color: #404040 !important;
        }
        body.dark-mode #login-error {
            background-color: rgba(239, 68, 68, 0.1) !important;
            border-color: rgba(239, 68, 68, 0.3) !important;
        }
        body.dark-mode .bg-gradient-to-r {
            background: linear-gradient(to right, #1e3a5f, #2d1b4e) !important;
        }
        body.dark-mode .border-blue-200 {
            border-color: #3b4f6b !important;
        }
        body.dark-mode .text-blue-600 {
            color: #60a5fa !important;
        }
        body.dark-mode .text-orange-600 {
            color: #fb923c !important;
        }
        body.dark-mode .bg-green-50 {
            background-color: rgba(34, 197, 94, 0.08) !important;
        }
        body.dark-mode .bg-green-50:hover {
            background-color: rgba(34, 197, 94, 0.12) !important;
        }
        body.dark-mode .bg-blue-50 {
            background-color: #1e3a5f !important;
        }
        body.dark-mode .bg-blue-100:hover {
            background-color: #2d4a6f !important;
        }
        body.dark-mode .bg-red-50 {
            background-color: #3d1f1f !important;
        }
        body.dark-mode .bg-red-100:hover {
            background-color: #4d2f2f !important;
        }
        body.dark-mode .text-blue-600 {
            color: #60a5fa !important;
        }
        body.dark-mode .text-red-600 {
            color: #f87171 !important;
        }
        
        /* Confetti styles */
        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            z-index: 9999;
            pointer-events: none;
        }
        
        @keyframes confetti-fall {
            to {
                transform: translateY(100vh) rotate(360deg);
                opacity: 0;
            }
        }
    </style>
</head>
<body class="min-h-screen bg-gray-50">
    <!-- Login Screen -->
    <div id="login-screen" class="fixed inset-0 flex items-center justify-center p-4 z-50" style="background: linear-gradient(135deg, #000000 0%, #1a1a1a 50%, #000000 100%);">
        <!-- Animated background shapes -->
        <div class="bg-shape bg-shape-1" style="background: linear-gradient(45deg, #333333, #555555);"></div>
        <div class="bg-shape bg-shape-2" style="background: linear-gradient(45deg, #2a2a2a, #444444);"></div>
        <div class="bg-shape bg-shape-3" style="background: linear-gradient(45deg, #3a3a3a, #4a4a4a);"></div>
        
        <div class="rounded-2xl shadow-2xl max-w-md w-full p-8 animate-slideUp relative z-10" style="background: rgba(20, 20, 20, 0.95); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.1);">
            
            <div class="text-center mb-8">
                <h1 class="text-5xl font-bold mb-2 animate-float" style="background: linear-gradient(135deg, #ffffff 0%, #cccccc 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">
                    IOQM Pro
                </h1>
                <p class="text-gray-400 animate-slideInRight">Track your IOQM preparation journey</p>
            </div>
            
            <div class="space-y-4">
                <div class="relative">
                    <label class="block text-sm font-semibold text-gray-300 mb-2 flex items-center gap-2">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                            <circle cx="12" cy="7" r="4"></circle>
                        </svg>
                        Enter Username
                    </label>
                    <input type="text" id="username-input" 
                           placeholder="Choose a unique username" 
                           class="fancy-input w-full px-4 py-3 border-2 rounded-xl focus:outline-none focus:ring-2 focus:border-transparent transition-all duration-300"
                           style="background-color: #0a0a0a; color: #ffffff; border-color: #333333; box-shadow: 0 0 0 0 rgba(255, 255, 255, 0);"
                           maxlength="20"
                           autocomplete="off"
                           autofocus>
                    <p class="text-xs text-gray-500 mt-2 flex items-center gap-1">
                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"></circle>
                            <line x1="12" y1="16" x2="12" y2="12"></line>
                            <line x1="12" y1="8" x2="12.01" y2="8"></line>
                        </svg>
                        3-20 characters, letters and numbers only
                    </p>
                </div>
                
                <button onclick="loginUser()" 
                        class="fancy-button w-full text-white py-3 rounded-xl font-semibold transition-all duration-300 transform relative z-10" style="background: linear-gradient(135deg, #2a2a2a 0%, #1a1a1a 100%);">
                    <span class="relative z-10 flex items-center justify-center gap-2">
                        Continue
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="5" y1="12" x2="19" y2="12"></line>
                            <polyline points="12 5 19 12 12 19"></polyline>
                        </svg>
                    </span>
                </button>
                
                <div id="login-error" class="hidden text-red-400 text-sm text-center font-semibold p-3 rounded-lg" style="background-color: rgba(100, 100, 100, 0.2); border: 1px solid rgba(150, 150, 150, 0.3);"></div>
            </div>
            
            <!-- Feature highlights -->
            <div class="mt-8 pt-6" style="border-top: 1px solid #333333;">
                <div class="grid grid-cols-3 gap-4 text-center">
                    <div class="animate-slideInLeft">
                        <div class="text-2xl mb-1">üìä</div>
                        <div class="text-xs text-gray-400 font-medium">Track Progress</div>
                    </div>
                    <div class="animate-slideInLeft" style="animation-delay: 0.1s">
                        <div class="text-2xl mb-1">üî•</div>
                        <div class="text-xs text-gray-400 font-medium">Build Streaks</div>
                    </div>
                    <div class="animate-slideInLeft" style="animation-delay: 0.2s">
                        <div class="text-2xl mb-1">üéØ</div>
                        <div class="text-xs text-gray-400 font-medium">Ace IOQM</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="app" class="p-4 md:p-6 hidden">
        <!-- Header -->
        <div class="max-w-7xl mx-auto mb-6">
            <div class="flex justify-between items-center">
                <div>
                    <a href="https://www.pw.live/study/batches?batchChildUrl=%2Fbatches-new%2Fbatches%2Fioqm-2025-206643%2Fsubjects%2Fmathematics-976776%2Fsubject-topics%3FcontentOption%3D%26subject%3DMathematics%26batchSubjectId%3D678603472ac40557c3131c3b"
                       target="_blank"
                       rel="noopener noreferrer"
                       class="text-4xl font-bold text-gray-900 hover:text-gray-600 transition-all duration-300 transform hover:scale-105">
                        IOQM Pro
                    </a>
                    <p class="text-sm text-gray-600 mt-1">Welcome, <span id="current-username" class="font-semibold text-gray-900"></span>!</p>
                </div>
                <div class="flex gap-3">
                    <button onclick="showAnalytics()"
                            class="flex items-center gap-2 px-4 py-2 bg-gray-900 text-white rounded-lg hover:bg-gray-700 transition-all duration-300 transform hover:scale-105 hover:shadow-lg">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="18" y1="20" x2="18" y2="10"></line>
                            <line x1="12" y1="20" x2="12" y2="4"></line>
                            <line x1="6" y1="20" x2="6" y2="14"></line>
                        </svg>
                        <span class="text-sm font-semibold">Analytics</span>
                    </button>
                    <button onclick="toggleSettings()"
                            class="flex items-center gap-2 px-4 py-2 bg-gray-900 text-white rounded-lg hover:bg-gray-700 transition-all duration-300 transform hover:scale-105 hover:shadow-lg">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"></path>
                            <circle cx="12" cy="12" r="3"></circle>
                        </svg>
                        <span class="text-sm font-semibold">Settings</span>
                    </button>
                </div>
            </div>
        </div>

        <div class="max-w-7xl mx-auto">
            <!-- Compact Stats -->
            <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-3 mb-4 transition-shadow duration-300 hover:shadow-md">
                <div class="grid grid-cols-4 gap-3 text-center">
                    <div>
                        <div class="text-xs text-gray-600 mb-1">Progress</div>
                        <div id="overall-progress" class="text-xl font-bold text-gray-900">0%</div>
                    </div>
                    <div>
                        <div class="text-xs text-gray-600 mb-1">Streak</div>
                        <div id="streak-count" class="text-xl font-bold text-gray-900">0 üî•</div>
                    </div>
                    <div>
                        <div class="text-xs text-gray-600 mb-1">Chapters</div>
                        <div id="chapters-count" class="text-xl font-bold text-gray-900">0/17</div>
                    </div>
                    <div>
                        <div class="text-xs text-gray-600 mb-1">Lectures</div>
                        <div id="lectures-count" class="text-xl font-bold text-gray-900">0/0</div>
                    </div>
                </div>
            </div>

            <!-- Chapters Container -->
            <div id="chapters-container"></div>
        </div>

        <!-- Footer -->
        <div class="max-w-7xl mx-auto mt-8">
            <div class="text-center py-4">
                <p class="text-gray-600 text-sm">¬© 2025 IOQM Pro ‚Äì All rights reserved.</p>
                <p class="text-gray-600 text-sm mt-1">Developed with <span class="text-red-500">‚ù§</span> by Meoponly</p>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settings-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 hidden animate-fadeIn">
        <div class="bg-white rounded-lg shadow-xl max-w-md w-full animate-slideUp">
            <div class="flex justify-between items-center p-6 border-b border-gray-200">
                <h2 class="text-2xl font-bold text-gray-900">Settings</h2>
                <button onclick="hideSettings()" class="text-gray-500 hover:text-gray-700 transition-colors">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            <div class="p-6 space-y-4">
                <!-- Change Theme -->
                <button onclick="changeTheme()" class="w-full flex items-center gap-3 p-4 bg-gray-50 hover:bg-gray-100 rounded-lg transition-colors">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                    <div class="text-left">
                        <div class="font-semibold text-gray-900">Change Theme</div>
                        <div class="text-sm text-gray-600">Switch between light and dark mode</div>
                    </div>
                </button>

                <!-- Export Data -->
                <button onclick="exportToExcel()" class="w-full flex items-center gap-3 p-4 bg-green-50 hover:bg-green-100 rounded-lg transition-colors">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="text-green-600">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                        <polyline points="7 10 12 15 17 10"></polyline>
                        <line x1="12" y1="15" x2="12" y2="3"></line>
                    </svg>
                    <div class="text-left">
                        <div class="font-semibold text-green-600">Export to Excel</div>
                        <div class="text-sm text-gray-600">Download your progress as CSV file</div>
                    </div>
                </button>

                <!-- Reset Data -->
                <button onclick="confirmReset()" class="w-full flex items-center gap-3 p-4 bg-red-50 hover:bg-red-100 rounded-lg transition-colors">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="text-red-600">
                        <polyline points="1 4 1 10 7 10"></polyline>
                        <path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"></path>
                    </svg>
                    <div class="text-left">
                        <div class="font-semibold text-red-600">Reset Data</div>
                        <div class="text-sm text-gray-600">Clear all progress and start fresh</div>
                    </div>
                </button>

                <!-- Logout -->
                <button onclick="logoutUser()" class="w-full flex items-center gap-3 p-4 bg-blue-50 hover:bg-blue-100 rounded-lg transition-colors">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="text-blue-600">
                        <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                        <polyline points="16 17 21 12 16 7"></polyline>
                        <line x1="21" y1="12" x2="9" y2="12"></line>
                    </svg>
                    <div class="text-left">
                        <div class="font-semibold text-blue-600">Logout</div>
                        <div class="text-sm text-gray-600">Sign out from your account</div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Analytics Modal -->
    <div id="analytics-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 hidden animate-fadeIn">
        <div class="bg-white rounded-lg shadow-xl max-w-6xl w-full max-h-[90vh] overflow-hidden animate-slideUp flex flex-col">
            <div class="flex justify-between items-center p-6 border-b border-gray-200 flex-shrink-0">
                <h2 class="text-2xl font-bold text-gray-900">Analytics Dashboard</h2>
                <button onclick="hideAnalytics()" class="text-gray-500 hover:text-gray-700 transition-colors">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            <div id="analytics-content" class="p-6 overflow-y-auto flex-1"></div>
        </div>
    </div>

    <script>
        let currentUsername = null;
        const defaultChapters = [
            {
                id: 1, subject: "Mathematics", name: "Basic Mathematics",
                lectures: [
                    { id: 1, name: "Basic Identities", video: false, dpp: false, notes: false },
                    { id: 2, name: "Factorization, Simon's Favourite Factoring Technique", video: false, dpp: false, notes: false },
                    { id: 3, name: "Doubt Class (Part-01)", video: false, dpp: false, notes: false },
                    { id: 4, name: "Factorization (Part-02)", video: false, dpp: false, notes: false },
                    { id: 5, name: "Basic Inequalities", video: false, dpp: false, notes: false },
                    { id: 6, name: "Wavy Curve Method", video: false, dpp: false, notes: false },
                    { id: 7, name: "Doubt Class (Part-02)", video: false, dpp: false, notes: false },
                    { id: 8, name: "Inequalities", video: false, dpp: false, notes: false },
                    { id: 9, name: "Irrational Inequalities", video: false, dpp: false, notes: false },
                    { id: 10, name: "Irrational Inequalities (Part-02)", video: false, dpp: false, notes: false },
                    { id: 11, name: "Modulus Function", video: false, dpp: false, notes: false },
                    { id: 12, name: "Inequalities Involving Absolute Value", video: false, dpp: false, notes: false },
                    { id: 13, name: "Factor Theorem and Remainder Theorem", video: false, dpp: false, notes: false },
                    { id: 14, name: "Logarithms (Part-01)", video: false, dpp: false, notes: false },
                    { id: 15, name: "Logarithms (Part-02)", video: false, dpp: false, notes: false },
                    { id: 16, name: "Logarithms (Part-03)", video: false, dpp: false, notes: false, hasTest: true, testDone: false, moduleDone: false, revisionDone: false }
                ]
            },
            {
                id: 2, subject: "Mathematics", name: "Number Theory (Part-01)",
                lectures: [
                    { id: 1, name: "Divisibility, Tests of Divisibility", video: false, dpp: false, notes: false },
                    { id: 2, name: "Division Algorithm", video: false, dpp: false, notes: false },
                    { id: 3, name: "Euclidean Algorithm (Part-01)", video: false, dpp: false, notes: false },
                    { id: 4, name: "Euclidean Algorithm (Part-02)", video: false, dpp: false, notes: false },
                    { id: 5, name: "Fundamental Theorem of Arithmetic", video: false, dpp: false, notes: false },
                    { id: 6, name: "GCD and LCM", video: false, dpp: false, notes: false },
                    { id: 7, name: "Prime Number", video: false, dpp: false, notes: false },
                    { id: 8, name: "Composite Numbers, Perfect Squares", video: false, dpp: false, notes: false },
                    { id: 9, name: "Doubt Class", video: false, dpp: false, notes: false },
                    { id: 10, name: "Modulus Functions", video: false, dpp: false, notes: false },
                    { id: 11, name: "Modulus Functions (Part-02)", video: false, dpp: false, notes: false },
                    { id: 12, name: "Miscellaneous Problems", video: false, dpp: false, notes: false, hasTest: true, testDone: false, moduleDone: false, revisionDone: false }
                ]
            },
            {
                id: 3, subject: "Mathematics", name: "Number Theory (Part-02)",
                lectures: [
                    { id: 1, name: "GIF, FPF", video: false, dpp: false, notes: false },
                    { id: 2, name: "Number Theoretic Function (Part-01)", video: false, dpp: false, notes: false },
                    { id: 3, name: "Number Theoretic Function (Part-02)", video: false, dpp: false, notes: false },
                    { id: 4, name: "Miscellaneous Problems", video: false, dpp: false, notes: false, hasTest: true, testDone: false, moduleDone: false, revisionDone: false }
                ]
            },
            {
                id: 4, subject: "Mathematics", name: "Number Theory (Part-03)",
                lectures: [
                    { id: 1, name: "Base System, Congruences", video: false, dpp: false, notes: false },
                    { id: 2, name: "Fermat Theorem, Wilson Theorem", video: false, dpp: false, notes: false },
                    { id: 3, name: "Euler's Theorem", video: false, dpp: false, notes: false },
                    { id: 4, name: "Chinese Remainder Theorem", video: false, dpp: false, notes: false },
                    { id: 5, name: "Unit Digit and Last Two Digits", video: false, dpp: false, notes: false },
                    { id: 6, name: "Diophantine Equation (Part-01)", video: false, dpp: false, notes: false },
                    { id: 7, name: "Diophantine Equation (Part-02)", video: false, dpp: false, notes: false, hasTest: true, testDone: false, moduleDone: false, revisionDone: false }
                ]
            },
            {
                id: 5, subject: "Mathematics", name: "Algebra ‚Äì Polynomial & Quadratic Equation",
                lectures: [
                    { id: 1, name: "Polynomials and its Types, Quadratic Polynomial", video: false, dpp: false, notes: false },
                    { id: 2, name: "Equation vs Identity, Relation Between Roots", video: false, dpp: false, notes: false },
                    { id: 3, name: "Symmetric Function of the Roots", video: false, dpp: false, notes: false },
                    { id: 4, name: "Transformation of Equation", video: false, dpp: false, notes: false },
                    { id: 5, name: "Rational Root Theorem, Integer Root Theorem", video: false, dpp: false, notes: false },
                    { id: 6, name: "Irreducibility of Polynomials", video: false, dpp: false, notes: false },
                    { id: 7, name: "Common Roots", video: false, dpp: false, notes: false },
                    { id: 8, name: "Theory of Equations, Graph and Sign of Roots", video: false, dpp: false, notes: false },
                    { id: 9, name: "Graph and Sign of Real Quadratic Expression", video: false, dpp: false, notes: false },
                    { id: 10, name: "Range of Quadratic Expression", video: false, dpp: false, notes: false, hasTest: true, testDone: false, moduleDone: false, revisionDone: false }
                ]
            },
            {
                id: 6, subject: "Mathematics", name: "Algebra ‚Äì Sequence and Series",
                lectures: [
                    { id: 1, name: "Introduction to Sequence and Series, AP", video: false, dpp: false, notes: false },
                    { id: 2, name: "Properties of AP", video: false, dpp: false, notes: false },
                    { id: 3, name: "Practice Session", video: false, dpp: false, notes: false },
                    { id: 4, name: "Introduction to GP", video: false, dpp: false, notes: false },
                    { id: 5, name: "Properties of GP, GM", video: false, dpp: false, notes: false },
                    { id: 6, name: "Harmonic Progression, Harmonic Mean", video: false, dpp: false, notes: false },
                    { id: 7, name: "Method of Difference, AGP", video: false, dpp: false, notes: false },
                    { id: 8, name: "AGP, Telescoping Series", video: false, dpp: false, notes: false },
                    { id: 9, name: "Relation Between AM, GM, HM", video: false, dpp: false, notes: false, hasTest: true, testDone: false, moduleDone: false, revisionDone: false }
                ]
            },
            {
                id: 7, subject: "Mathematics", name: "Recurrence Relation",
                lectures: [
                    { id: 1, name: "Recurrence Relation (Part-01)", video: false, dpp: false, notes: false },
                    { id: 2, name: "Recurrence Relation (Part-02)", video: false, dpp: false, notes: false },
                    { id: 3, name: "Recurrence Relation (Part-03)", video: false, dpp: false, notes: false, hasTest: true, testDone: false, moduleDone: false, revisionDone: false }
                ]
            },
            {
                id: 8, subject: "Mathematics", name: "Inequalities",
                lectures: [
                    { id: 1, name: "Basics of Inequalities", video: false, dpp: false, notes: false },
                    { id: 2, name: "AM-GM Inequality", video: false, dpp: false, notes: false },
                    { id: 3, name: "Mean Inequality", video: false, dpp: false, notes: false },
                    { id: 4, name: "Cauchy Schwarz Inequality", video: false, dpp: false, notes: false },
                    { id: 5, name: "Titu's Lemma", video: false, dpp: false, notes: false },
                    { id: 6, name: "Rearrangement Inequality", video: false, dpp: false, notes: false },
                    { id: 7, name: "Jensen Inequality, Chebyshev Inequality", video: false, dpp: false, notes: false, hasTest: true, testDone: false, moduleDone: false, revisionDone: false }
                ]
            },
            {
                id: 9, subject: "Mathematics", name: "Geometry ‚Äì Triangles",
                lectures: [
                    { id: 1, name: "Introduction to Geometry, Trigonometry Introduction", video: false, dpp: false, notes: false },
                    { id: 2, name: "Angle Chasing (Part-01)", video: false, dpp: false, notes: false },
                    { id: 3, name: "Angle Chasing (Part-02)", video: false, dpp: false, notes: false },
                    { id: 4, name: "Congruence and Similarity", video: false, dpp: false, notes: false },
                    { id: 5, name: "Area Lemma", video: false, dpp: false, notes: false },
                    { id: 6, name: "Triangle Inequality (Part-01)", video: false, dpp: false, notes: false },
                    { id: 7, name: "Stewart's Theorem, Menelaus Theorem", video: false, dpp: false, notes: false, hasTest: true, testDone: false, moduleDone: false, revisionDone: false }
                ]
            },
            {
                id: 10, subject: "Mathematics", name: "Geometry ‚Äì Quadrilaterals & Circles",
                lectures: [
                    { id: 1, name: "Quadrilaterals", video: false, dpp: false, notes: false },
                    { id: 2, name: "Circles (Part-01)", video: false, dpp: false, notes: false },
                    { id: 3, name: "Circles (Part-02)", video: false, dpp: false, notes: false },
                    { id: 4, name: "Centre and Triangle", video: false, dpp: false, notes: false },
                    { id: 5, name: "Concurrency and Collinearity", video: false, dpp: false, notes: false },
                    { id: 6, name: "Applications of Trigonometry in Geometry", video: false, dpp: false, notes: false, hasTest: true, testDone: false, moduleDone: false, revisionDone: false }
                ]
            },
            {
                id: 11, subject: "Mathematics", name: "Geometry ‚Äì Coordinate Geometry",
                lectures: [
                    { id: 1, name: "Basics of Coordinate Geometry", video: false, dpp: false, notes: false },
                    { id: 2, name: "Practice Session", video: false, dpp: false, notes: false, hasTest: true, testDone: false, moduleDone: false, revisionDone: false }
                ]
            },
            {
                id: 12, subject: "Mathematics", name: "Binomial Theorem",
                lectures: [
                    { id: 1, name: "Expansion of Binomial", video: false, dpp: false, notes: false },
                    { id: 2, name: "Expansion, Middle Term", video: false, dpp: false, notes: false },
                    { id: 3, name: "Properties of Binomial Coefficient", video: false, dpp: false, notes: false },
                    { id: 4, name: "Properties of Binomial Coefficient (Part-02)", video: false, dpp: false, notes: false, hasTest: true, testDone: false, moduleDone: false, revisionDone: false }
                ]
            },
            {
                id: 13, subject: "Mathematics", name: "Combinatorics (Part-01)",
                lectures: [
                    { id: 1, name: "Introduction", video: false, dpp: false, notes: false },
                    { id: 2, name: "Permutation and Combination", video: false, dpp: false, notes: false },
                    { id: 3, name: "Selection Based Problems", video: false, dpp: false, notes: false },
                    { id: 4, name: "Gap Method and Block Method", video: false, dpp: false, notes: false },
                    { id: 5, name: "Arrangement When Items are Alike", video: false, dpp: false, notes: false },
                    { id: 6, name: "Grouping and Distribution", video: false, dpp: false, notes: false },
                    { id: 7, name: "Arrangement of Alike Objects, Rank of Word", video: false, dpp: false, notes: false },
                    { id: 8, name: "At Least One Selection, Grid Problem, Circular Permutation", video: false, dpp: false, notes: false },
                    { id: 9, name: "Circular Permutation (Part-02)", video: false, dpp: false, notes: false, hasTest: true, testDone: false, moduleDone: false, revisionDone: false }
                ]
            },
            {
                id: 14, subject: "Mathematics", name: "Combinatorics (Part-02)",
                lectures: [
                    { id: 1, name: "Principle of Inclusion and Exclusion", video: false, dpp: false, notes: false },
                    { id: 2, name: "Beggar's Method", video: false, dpp: false, notes: false },
                    { id: 3, name: "Multinomial Theorem", video: false, dpp: false, notes: false },
                    { id: 4, name: "Derangement", video: false, dpp: false, notes: false },
                    { id: 5, name: "Recurrence Relation and Pigeonhole Principle", video: false, dpp: false, notes: false },
                    { id: 6, name: "Tiling, Coloring, Bijection Principle", video: false, dpp: false, notes: false, hasTest: true, testDone: false, moduleDone: false, revisionDone: false }
                ]
            },
            {
                id: 15, subject: "Mathematics", name: "Probability",
                lectures: [
                    { id: 1, name: "Classic Definition of Probability", video: false, dpp: false, notes: false, hasTest: true, testDone: false, moduleDone: false, revisionDone: false }
                ]
            },
            {
                id: 16, subject: "Mathematics", name: "Functions / Functional Equation",
                lectures: [
                    { id: 1, name: "Introduction to Function and Functional Equation", video: false, dpp: false, notes: false },
                    { id: 2, name: "Types of Functional Equation", video: false, dpp: false, notes: false, hasTest: true, testDone: false, moduleDone: false, revisionDone: false }
                ]
            },
            {
                id: 17, subject: "Mathematics", name: "Extra / Special Sessions",
                lectures: [
                    { id: 1, name: "Charcha Session", video: false, dpp: false, notes: false },
                    { id: 2, name: "Extra Session ‚Äì Combinatorics", video: false, dpp: false, notes: false, hasTest: true, testDone: false, moduleDone: false, revisionDone: false }
                ]
            }
        ];

        let chapters = [];
        let streak = 0;
        let lastStudyDate = null;
        const examDate = '2026-09-01';

        // Username validation
        function validateUsername(username) {
            const regex = /^[a-zA-Z0-9]{3,20}$/;
            return regex.test(username);
        }

        // Login function
        function loginUser() {
            const usernameInput = document.getElementById('username-input');
            const username = usernameInput.value.trim();
            const errorDiv = document.getElementById('login-error');
            
            if (!validateUsername(username)) {
                errorDiv.textContent = 'Username must be 3-20 characters (letters and numbers only)';
                errorDiv.classList.remove('hidden');
                return;
            }
            
            currentUsername = username;
            errorDiv.classList.add('hidden');
            
            // Hide login screen, show app
            document.getElementById('login-screen').classList.add('hidden');
            document.getElementById('app').classList.remove('hidden');
            
            // Update username display
            document.getElementById('current-username').textContent = username;
            
            // Save current username to localStorage
            localStorage.setItem('currentUsername', username);
            
            // Load user data
            loadData();
            render();
        }

        // Logout function
        function logoutUser() {
            if (confirm('Are you sure you want to logout?')) {
                currentUsername = null;
                localStorage.removeItem('currentUsername');
                hideSettings();
                document.getElementById('app').classList.add('hidden');
                document.getElementById('login-screen').classList.remove('hidden');
                document.getElementById('username-input').value = '';
            }
        }

        // Load data from localStorage
        function loadData() {
            if (!currentUsername) return;
            
            const userDataKey = `ioqm_user_${currentUsername}`;
            const saved = localStorage.getItem(userDataKey);
            
            if (saved) {
                try {
                    const data = JSON.parse(saved);
                    chapters = defaultChapters.map(defaultChapter => {
                        const savedChapter = data.chapters?.find(ch => ch.id === defaultChapter.id);
                        if (savedChapter) {
                            return {
                                ...defaultChapter,
                                lectures: defaultChapter.lectures.map(defaultLec => {
                                    const savedLec = savedChapter.lectures?.find(l => l.id === defaultLec.id);
                                    return savedLec ? { ...defaultLec, ...savedLec } : defaultLec;
                                })
                            };
                        }
                        return defaultChapter;
                    });
                    streak = data.streak || 0;
                    lastStudyDate = data.lastStudyDate || null;
                } catch (e) {
                    console.error('Error loading data:', e);
                    chapters = JSON.parse(JSON.stringify(defaultChapters));
                }
            } else {
                // New user - initialize with default data
                chapters = JSON.parse(JSON.stringify(defaultChapters));
                streak = 0;
                lastStudyDate = null;
            }
        }

        // Save data to localStorage
        function saveData() {
            if (!currentUsername) return;
            
            const data = {
                chapters: chapters,
                streak: streak,
                lastStudyDate: lastStudyDate,
                examDate: examDate,
                username: currentUsername,
                lastUpdated: new Date().toISOString()
            };
            
            const userDataKey = `ioqm_user_${currentUsername}`;
            localStorage.setItem(userDataKey, JSON.stringify(data));
        }

        function updateStreak() {
            const today = new Date();
            const todayStr = today.toDateString();
            
            if (lastStudyDate !== todayStr) {
                if (lastStudyDate) {
                    const lastDate = new Date(lastStudyDate);
                    const yesterday = new Date(today);
                    yesterday.setDate(yesterday.getDate() - 1);
                    
                    // Check if last study was yesterday (consecutive day)
                    if (lastDate.toDateString() === yesterday.toDateString()) {
                        streak = streak + 1;
                    } else {
                        // Streak broken, start new streak
                        streak = 1;
                    }
                } else {
                    // First time studying
                    streak = 1;
                }
                lastStudyDate = todayStr;
            }
        }

        function toggleTask(chapterId, lectureId, taskType) {
            const chapter = chapters.find(c => c.id === chapterId);
            const lecture = chapter.lectures.find(l => l.id === lectureId);
            
            // Store previous state to check if lecture was just completed
            const wasComplete = isLectureFullyComplete(lecture);
            
            lecture[taskType] = !lecture[taskType];
            
            // Only update streak if we're checking something (not unchecking)
            if (lecture[taskType]) {
                updateStreak();
                
                // Check if lecture is now complete (after toggling)
                const isNowComplete = isLectureFullyComplete(lecture);
                
                // Trigger confetti only if lecture just became complete
                if (!wasComplete && isNowComplete) {
                    createConfetti();
                }
            }
            
            saveData();
            render();
        }

        // Helper function to check if a lecture is fully complete
        function isLectureFullyComplete(lecture) {
            const basicComplete = lecture.video && lecture.dpp && lecture.notes;
            const additionalComplete = lecture.hasTest ? (lecture.testDone && lecture.moduleDone && lecture.revisionDone) : true;
            return basicComplete && additionalComplete;
        }

        // Confetti effect
        function createConfetti() {
            const colors = ['#10B981', '#3B82F6', '#F59E0B', '#EF4444', '#8B5CF6', '#EC4899', '#14B8A6', '#F97316'];
            const confettiCount = 50;
            
            for (let i = 0; i < confettiCount; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.left = (Math.random() * 100) + '%';
                    confetti.style.top = '-10px';
                    confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                    confetti.style.borderRadius = Math.random() > 0.5 ? '50%' : '0';
                    confetti.style.animation = `confetti-fall ${2 + Math.random()}s linear forwards`;
                    document.body.appendChild(confetti);
                    
                    setTimeout(() => {
                        if (confetti.parentNode) {
                            confetti.remove();
                        }
                    }, 4000);
                }, i * 20);
            }
        }

        function getChapterProgress(chapter) {
            let totalTasks = 0;
            let completedTasks = 0;
            chapter.lectures.forEach(lecture => {
                totalTasks += 3;
                if (lecture.video) completedTasks++;
                if (lecture.dpp) completedTasks++;
                if (lecture.notes) completedTasks++;
                
                if (lecture.hasTest) {
                    totalTasks += 3;
                    if (lecture.testDone) completedTasks++;
                    if (lecture.moduleDone) completedTasks++;
                    if (lecture.revisionDone) completedTasks++;
                }
            });
            return totalTasks > 0 ? ((completedTasks / totalTasks) * 100).toFixed(2) : 0;
        }

        function getCompletedLectures(chapter) {
            return chapter.lectures.filter(lec => {
                const basicComplete = lec.video && lec.dpp && lec.notes;
                const testComplete = lec.hasTest ? (lec.testDone && lec.moduleDone && lec.revisionDone) : true;
                return basicComplete && testComplete;
            }).length;
        }

        function calculateProgress() {
            let totalTasks = 0;
            let completedTasks = 0;
            chapters.forEach(chapter => {
                chapter.lectures.forEach(lecture => {
                    totalTasks += 3;
                    if (lecture.video) completedTasks++;
                    if (lecture.dpp) completedTasks++;
                    if (lecture.notes) completedTasks++;
                    
                    if (lecture.hasTest) {
                        totalTasks += 3;
                        if (lecture.testDone) completedTasks++;
                        if (lecture.moduleDone) completedTasks++;
                        if (lecture.revisionDone) completedTasks++;
                    }
                });
            });
            return totalTasks > 0 ? ((completedTasks / totalTasks) * 100).toFixed(2) : 0;
        }

        function getDaysRemaining() {
            const today = new Date();
            const exam = new Date(examDate);
            const diff = exam - today;
            return Math.ceil(diff / (1000 * 60 * 60 * 24));
        }

        function render() {
            const progress = calculateProgress();
            const completedChapters = chapters.filter(chapter => 
                chapter.lectures.every(lec => {
                    const basicComplete = lec.video && lec.dpp && lec.notes;
                    const testComplete = lec.hasTest ? (lec.testDone && lec.moduleDone && lec.revisionDone) : true;
                    return basicComplete && testComplete;
                })
            ).length;
            
            const totalLectures = chapters.reduce((sum, ch) => sum + ch.lectures.length, 0);
            const completedLectures = chapters.reduce((sum, ch) => sum + getCompletedLectures(ch), 0);

            document.getElementById('overall-progress').textContent = progress + '%';
            document.getElementById('streak-count').textContent = streak + ' üî•';
            document.getElementById('chapters-count').textContent = `${completedChapters}/${chapters.length}`;
            document.getElementById('lectures-count').textContent = `${completedLectures}/${totalLectures}`;

            const container = document.getElementById('chapters-container');
            container.innerHTML = chapters.map(chapter => {
                const chapterProgress = getChapterProgress(chapter);
                const lecturesDone = getCompletedLectures(chapter);
                
                return `
                    <div class="mb-4 rounded-lg shadow-sm overflow-hidden border border-gray-200 bg-white transition-all duration-300 hover:shadow-lg">
                        <div class="bg-gray-900 text-white p-3">
                            <div>
                                <h2 class="text-lg font-bold">${chapter.subject} - ${chapter.name}</h2>
                                <p class="text-sm text-gray-300">${lecturesDone}/${chapter.lectures.length} Lectures ‚Ä¢ ${chapterProgress}% Complete</p>
                            </div>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead class="bg-gray-100 border-b border-gray-200">
                                    <tr>
                                        <th class="px-4 py-2 text-left text-sm font-semibold text-gray-700">Lecture</th>
                                        <th class="px-4 py-2 text-center text-sm font-semibold text-gray-700">Video</th>
                                        <th class="px-4 py-2 text-center text-sm font-semibold text-gray-700">DPP</th>
                                        <th class="px-4 py-2 text-center text-sm font-semibold text-gray-700">Notes</th>
                                        <th class="px-4 py-2 text-center text-sm font-semibold text-gray-700">Test</th>
                                        <th class="px-4 py-2 text-center text-sm font-semibold text-gray-700">Module</th>
                                        <th class="px-4 py-2 text-center text-sm font-semibold text-gray-700">Revision</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${chapter.lectures.map(lecture => {
                                        const isLectureComplete = lecture.video && lecture.dpp && lecture.notes;
                                        const isAdditionalComplete = lecture.hasTest && lecture.testDone && lecture.moduleDone && lecture.revisionDone;
                                        
                                        return `
                                            <tr class="border-b border-gray-100 transition-colors duration-200 ${isLectureComplete && !lecture.hasTest ? 'bg-green-100' : 'hover:bg-gray-50'} ${isLectureComplete && isAdditionalComplete ? 'bg-green-100' : ''}">
                                                <td class="px-4 py-2">
                                                    <div class="text-sm font-medium text-gray-900">Lecture ${lecture.id}: ${lecture.name}</div>
                                                </td>
                                                <td class="px-4 py-2 text-center">
                                                    <button onclick="toggleTask(${chapter.id}, ${lecture.id}, 'video')" class="inline-flex items-center justify-center transition-transform duration-200 hover:scale-110">
                                                        ${lecture.video ? 
                                                            '<svg class="text-green-500" width="28" height="28" viewBox="0 0 24 24" fill="currentColor" stroke="white" stroke-width="2"><circle cx="12" cy="12" r="10" fill="currentColor"></circle><path d="M9 12l2 2 4-4" stroke="white" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"></path></svg>' : 
                                                            '<svg class="text-gray-300" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle></svg>'
                                                        }
                                                    </button>
                                                </td>
                                                <td class="px-4 py-2 text-center">
                                                    <button onclick="toggleTask(${chapter.id}, ${lecture.id}, 'dpp')" class="inline-flex items-center justify-center transition-transform duration-200 hover:scale-110">
                                                        ${lecture.dpp ? 
                                                            '<svg class="text-green-500" width="28" height="28" viewBox="0 0 24 24" fill="currentColor" stroke="white" stroke-width="2"><circle cx="12" cy="12" r="10" fill="currentColor"></circle><path d="M9 12l2 2 4-4" stroke="white" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"></path></svg>' : 
                                                            '<svg class="text-gray-300" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle></svg>'
                                                        }
                                                    </button>
                                                </td>
                                                <td class="px-4 py-2 text-center">
                                                    <button onclick="toggleTask(${chapter.id}, ${lecture.id}, 'notes')" class="inline-flex items-center justify-center transition-transform duration-200 hover:scale-110">
                                                        ${lecture.notes ? 
                                                            '<svg class="text-green-500" width="28" height="28" viewBox="0 0 24 24" fill="currentColor" stroke="white" stroke-width="2"><circle cx="12" cy="12" r="10" fill="currentColor"></circle><path d="M9 12l2 2 4-4" stroke="white" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"></path></svg>' : 
                                                            '<svg class="text-gray-300" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle></svg>'
                                                        }
                                                    </button>
                                                </td>
                                                <td class="px-4 py-2 text-center" colspan="3">
                                                    ${!lecture.hasTest ? '<span class="text-gray-400 text-sm">-</span>' : ''}
                                                </td>
                                            </tr>
                                            ${lecture.hasTest ? `
                                                <tr class="border-b border-gray-100 transition-colors duration-200 ${isAdditionalComplete ? 'bg-green-50' : 'hover:bg-gray-50'}">
                                                    <td class="px-4 py-2 pl-12">
                                                        <div class="text-xs font-medium text-gray-600 italic">‚îî‚îÄ Additional Tasks</div>
                                                    </td>
                                                    <td colspan="3"></td>
                                                    <td class="px-4 py-2 text-center">
                                                        <button onclick="toggleTask(${chapter.id}, ${lecture.id}, 'testDone')" class="inline-flex items-center justify-center transition-transform duration-200 hover:scale-110">
                                                            ${lecture.testDone ? 
                                                                '<svg class="text-green-500" width="28" height="28" viewBox="0 0 24 24" fill="currentColor" stroke="white" stroke-width="2"><circle cx="12" cy="12" r="10" fill="currentColor"></circle><path d="M9 12l2 2 4-4" stroke="white" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"></path></svg>' : 
                                                                '<svg class="text-gray-300" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle></svg>'
                                                            }
                                                        </button>
                                                    </td>
                                                    <td class="px-4 py-2 text-center">
                                                        <button onclick="toggleTask(${chapter.id}, ${lecture.id}, 'moduleDone')" class="inline-flex items-center justify-center transition-transform duration-200 hover:scale-110">
                                                            ${lecture.moduleDone ? 
                                                                '<svg class="text-green-500" width="28" height="28" viewBox="0 0 24 24" fill="currentColor" stroke="white" stroke-width="2"><circle cx="12" cy="12" r="10" fill="currentColor"></circle><path d="M9 12l2 2 4-4" stroke="white" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"></path></svg>' : 
                                                                '<svg class="text-gray-300" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle></svg>'
                                                            }
                                                        </button>
                                                    </td>
                                                    <td class="px-4 py-2 text-center">
                                                        <button onclick="toggleTask(${chapter.id}, ${lecture.id}, 'revisionDone')" class="inline-flex items-center justify-center transition-transform duration-200 hover:scale-110">
                                                            ${lecture.revisionDone ? 
                                                                '<svg class="text-green-500" width="28" height="28" viewBox="0 0 24 24" fill="currentColor" stroke="white" stroke-width="2"><circle cx="12" cy="12" r="10" fill="currentColor"></circle><path d="M9 12l2 2 4-4" stroke="white" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"></path></svg>' : 
                                                                '<svg class="text-gray-300" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle></svg>'
                                                            }
                                                        </button>
                                                    </td>
                                                </tr>
                                            ` : ''}
                                        `;
                                    }).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function showAnalytics() {
            const progress = calculateProgress();
            const daysRemaining = getDaysRemaining();
            const completedChapters = chapters.filter(chapter => 
                chapter.lectures.every(lec => {
                    const basicComplete = lec.video && lec.dpp && lec.notes;
                    const testComplete = lec.hasTest ? (lec.testDone && lec.moduleDone && lec.revisionDone) : true;
                    return basicComplete && testComplete;
                })
            ).length;
            const totalLectures = chapters.reduce((sum, ch) => sum + ch.lectures.length, 0);
            const completedLectures = chapters.reduce((sum, ch) => sum + getCompletedLectures(ch), 0);

            const content = `
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                    <div class="bg-gray-50 p-4 rounded-lg border border-gray-200">
                        <div class="text-sm text-gray-600 mb-1">Overall Progress</div>
                        <div class="text-3xl font-bold text-gray-900">${progress}%</div>
                    </div>
                    <div class="bg-gray-50 p-4 rounded-lg border border-gray-200">
                        <div class="text-sm text-gray-600 mb-1">Days to Exam</div>
                        <div class="text-3xl font-bold text-gray-900">${daysRemaining}</div>
                    </div>
                    <div class="bg-gray-50 p-4 rounded-lg border border-gray-200">
                        <div class="text-sm text-gray-600 mb-1">Current Streak</div>
                        <div class="text-3xl font-bold text-gray-900">${streak} üî•</div>
                    </div>
                    <div class="bg-gray-50 p-4 rounded-lg border border-gray-200">
                        <div class="text-sm text-gray-600 mb-1">Chapters Done</div>
                        <div class="text-3xl font-bold text-gray-900">${completedChapters}/${chapters.length}</div>
                    </div>
                </div>
                
                <div>
                    <h3 class="text-lg font-bold text-gray-900 mb-4">Chapter-wise Progress</h3>
                    <div class="space-y-3">
                        ${chapters.map((chapter, index) => {
                            const chapterProgress = getChapterProgress(chapter);
                            const lecturesDone = getCompletedLectures(chapter);
                            const colors = [
                                '#3B82F6', '#10B981', '#F59E0B', '#EF4444', '#8B5CF6', 
                                '#EC4899', '#14B8A6', '#F97316', '#6366F1', '#84CC16',
                                '#06B6D4', '#A855F7', '#F43F5E', '#22C55E', '#FACC15', '#EAB308', '#D946EF'
                            ];
                            
                            let totalTasks = 0;
                            let completedTasks = 0;
                            chapter.lectures.forEach(lec => {
                                totalTasks += 3;
                                if (lec.video) completedTasks++;
                                if (lec.dpp) completedTasks++;
                                if (lec.notes) completedTasks++;
                                if (lec.hasTest) {
                                    totalTasks += 3;
                                    if (lec.testDone) completedTasks++;
                                    if (lec.moduleDone) completedTasks++;
                                    if (lec.revisionDone) completedTasks++;
                                }
                            });
                            
                            return `
                                <div class="border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow">
                                    <div class="flex items-center gap-3 mb-2">
                                        <div class="w-4 h-4 rounded-full flex-shrink-0" style="background-color: ${colors[index % colors.length]}"></div>
                                        <div class="flex-1">
                                            <h4 class="font-semibold text-sm text-gray-900">${chapter.name}</h4>
                                            <p class="text-xs text-gray-600">${lecturesDone}/${chapter.lectures.length} lectures ‚Ä¢ ${completedTasks}/${totalTasks} tasks</p>
                                        </div>
                                        <div class="text-xl font-bold text-gray-900">${chapterProgress}%</div>
                                    </div>
                                    <div class="w-full bg-gray-200 rounded-full h-3">
                                        <div class="rounded-full h-3 transition-all duration-500" 
                                             style="width: ${chapterProgress}%; background-color: ${colors[index % colors.length]}"></div>
                                    </div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                </div>
                
                <div class="mt-6 bg-gradient-to-r from-blue-50 to-indigo-50 p-6 rounded-lg border border-blue-200">
                    <h3 class="text-lg font-bold text-gray-900 mb-3">üìä Study Insights</h3>
                    <div class="space-y-2">
                        <p class="text-gray-700"><span class="font-semibold text-blue-600">${totalLectures - completedLectures}</span> lectures remaining</p>
                        <p class="text-gray-700">Recommended pace: <span class="font-semibold text-blue-600">${daysRemaining > 0 ? ((totalLectures - completedLectures) / daysRemaining).toFixed(1) : 0}</span> lectures/day</p>
                        <p class="text-gray-700">Current streak: <span class="font-semibold text-orange-600">${streak} day${streak !== 1 ? 's' : ''} üî•</span></p>
                        ${lastStudyDate ? `<p class="text-xs text-gray-600 mt-2">Last study session: ${lastStudyDate}</p>` : ''}
                    </div>
                </div>
            `;
            
            document.getElementById('analytics-content').innerHTML = content;
            document.getElementById('analytics-modal').classList.remove('hidden');
        }

        function hideAnalytics() {
            document.getElementById('analytics-modal').classList.add('hidden');
        }

        function toggleSettings() {
            document.getElementById('settings-modal').classList.remove('hidden');
        }

        function hideSettings() {
            document.getElementById('settings-modal').classList.add('hidden');
        }

        function changeTheme() {
            document.body.classList.toggle('dark-mode');
            const isDark = document.body.classList.contains('dark-mode');
            localStorage.setItem('darkMode', isDark ? 'enabled' : 'disabled');
        }

        function confirmReset() {
            if (confirm('Are you sure you want to reset all your progress? This action cannot be undone!')) {
                chapters = JSON.parse(JSON.stringify(defaultChapters));
                streak = 0;
                lastStudyDate = null;
                saveData();
                hideSettings();
                render();
            }
        }

        function exportToExcel() {
            let csvContent = "Chapter,Lecture,Video,DPP,Notes,Test,Module,Revision\n";
            
            chapters.forEach(chapter => {
                chapter.lectures.forEach(lecture => {
                    csvContent += `"${chapter.name}","Lecture ${lecture.id}: ${lecture.name}",`;
                    csvContent += `${lecture.video ? 'Yes' : 'No'},`;
                    csvContent += `${lecture.dpp ? 'Yes' : 'No'},`;
                    csvContent += `${lecture.notes ? 'Yes' : 'No'},`;
                    csvContent += `${lecture.hasTest ? (lecture.testDone ? 'Yes' : 'No') : 'N/A'},`;
                    csvContent += `${lecture.hasTest ? (lecture.moduleDone ? 'Yes' : 'No') : 'N/A'},`;
                    csvContent += `${lecture.hasTest ? (lecture.revisionDone ? 'Yes' : 'No') : 'N/A'}\n`;
                });
            });

            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `ioqm_progress_${currentUsername}.csv`;
            a.click();
            window.URL.revokeObjectURL(url);
            
            hideSettings();
        }

        // Initialize
        function init() {
            // Check if user was previously logged in
            const savedUsername = localStorage.getItem('currentUsername');
            
            if (savedUsername) {
                currentUsername = savedUsername;
                document.getElementById('login-screen').classList.add('hidden');
                document.getElementById('app').classList.remove('hidden');
                document.getElementById('current-username').textContent = savedUsername;
                loadData();
                render();
            }
            
            // Load dark mode preference
            if (localStorage.getItem('darkMode') === 'enabled') {
                document.body.classList.add('dark-mode');
            }
            
            // Add enter key support for login
            document.getElementById('username-input').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    loginUser();
                }
            });
        }
        
        init();
    </script>
</body>
</html>
